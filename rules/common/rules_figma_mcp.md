# rules_figma_mcp.md - Figma MCP連携ルール

**作成日**: 2026-02-11  
**最終更新**: 2026-02-11  
**目的**: Figma MCPサーバーを使ったデザイン実装の共通ルール  
**対象**: Figmaデザインからのコード生成、Code Connect、デザインシステム連携

**関連ドキュメント**:
- `docs/実装仕様/Figma実装コンテキスト.md` - プロジェクト固有のデザインシステム・変換ルール
- `docs/作業メモ/20260211_120000_FigmaMCP構築手順.md` - セットアップ手順
- `docs/作業メモ/FigmaMCP_トラブルシューティング.md` - 接続エラー時の対処

---

## 1. Figma MCP サーバー設定

このプロジェクトでは以下の Figma MCP サーバーが利用可能です：

| サーバーID | URL | 用途 |
|-----------|-----|------|
| `figma` | https://mcp.figma.com/mcp | リモート（常時利用可能・認証必要） |
| `figma-desktop` | http://127.0.0.1:3845/mcp | デスクトップ連携（Figma アプリ + Dev Mode の MCP 有効化が必要） |

---

## 2. 必須フロー（スキップ禁止）

Figmaデザインを実装する際は以下の順序を厳守してください：

1. **get_design_context** を最初に実行し、対象ノードの構造化表現を取得
2. レスポンスが大きすぎる/ truncate された場合: **get_metadata** でノードマップを取得し、必要なノードのみ **get_design_context** で再取得
3. **get_screenshot** でビジュアルリファレンスを取得
4. **get_design_context** と **get_screenshot** の両方を取得した後にのみ、アセットのダウンロードと実装を開始
5. 出力（通常は React + Tailwind）をプロジェクトの規約・スタイル・フレームワークに変換
6. 完成前に Figma と 1:1 で照合して検証

---

## 3. プロジェクト固有の実装ルール

**Figma 実装時に必ず参照**: `docs/実装仕様/Figma実装コンテキスト.md`  
（デザインシステム、ディレクトリ構成、コンポーネントパターン、変換チェックリスト）

### 3.1 技術スタックの変換

- 本プロジェクトは **Jinja2 テンプレート + HTML + Tailwind CSS（CDN）** を使用（React/Next.js は非採用）
- Figma MCP のデフォルト出力（React + Tailwind）は「デザイン・動作の表現」であり、そのまま使用しない
- 出力を **Jinja2 + HTML** および **本プロジェクトの Tailwind デザインシステム** に変換すること（`Figma実装コンテキスト.md` 参照）

### 3.2 アセットの扱い

- **IMPORTANT**: Figma MCP サーバーが localhost の画像/SVG ソースを返した場合、そのソースを直接使用すること
- **IMPORTANT**: 新しいアイコンパッケージを import または追加してはいけない。アセットはすべて Figma ペイロードから取得
- **IMPORTANT**: localhost ソースが提供されている場合、プレースホルダーを使用・作成してはいけない
- アセットは `assets/images/` 配下に配置

### 3.3 既存コンポーネントの再利用

- `templates/base.html`、`templates/hero_content.html` のレイアウト・パターンを可能な限り再利用する
- カラーパレット（zinc-950/50、white/10 等）、タイポグラフィ、スペーシングを一貫して使用する（`Figma実装コンテキスト.md` セクション4参照）

---

## 4. URL・ノードIDの取り扱い

### 4.1 Figma URL 形式

```
https://figma.com/design/:fileKey/:fileName?node-id=1-2
```

### 4.2 ノードIDの変換

- URL 形式: `node-id=1-2`（ハイフン）
- ツール引数形式: `nodeId=1:2`（コロン）
- **必ず** URL の `1-2` を `1:2` に変換してツールに渡すこと

### 4.3 figma-desktop 使用時

- `figma-desktop` MCP 使用時は `fileKey` は不要。開いているファイルの選択ノードが自動で使用される
- URL がなくても、Figma デスクトップでノードを選択した状態でプロンプト可能

---

## 5. 検証チェックリスト

実装完了前に以下を確認すること：

- [ ] レイアウトが一致（スペーシング、配置、サイズ）
- [ ] タイポグラフィが一致（フォント、サイズ、ウェイト、行高）
- [ ] 色が正確に一致
- [ ] インタラクティブ状態がデザイン通り（hover、active、disabled）
- [ ] レスポンシブ動作が Figma の制約に従う
- [ ] アセットが正しく表示される

---

**バージョン**: 1.1
