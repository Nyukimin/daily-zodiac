# セキュリティ仕様（LLM APIキー取り扱い：最小要件）

## 目的
- 公開リポジトリ（GitHub Pages配布）でも、LLM APIキーを漏洩させずに日次生成を運用する。
- 生成処理はキーが無くても必ず完走し、公開物（site/）は常に生成可能である。

## 要件（MUST）

### 1. キーの保管
- LLMのAPIキーはGitHub Actionsの「Repository Secrets」に保存すること。
- APIキーをリポジトリ内（ファイル、README、設定、テンプレ、コメント、履歴）に含めてはならない。

### 2. 注入経路の限定
- APIキーはGitHub Actionsの実行時にのみ、環境変数として注入すること。
- ローカル実行でAPIキーが必要な場合でも、.env等をリポジトリに含めず、開発者のローカル環境変数で管理すること（リポジトリ管理外）。

### 3. フォールバック動作
- generate.py は LLM_API_KEY が存在しない場合、またはLLM呼び出しに失敗した場合でも、必ずフォールバックで生成を完走すること。
- フォールバックは決定論（乱数なし）で、日付キーにより同日中は結果が不変であること。

### 4. ログ出力の制約
- generate.py は LLM_API_KEY の値をログに出力してはならない。
- ActionsのログにAPIキーが出力されうる情報（リクエストヘッダ、設定ダンプ、デバッグログ等）を出力してはならない。
- ログで許容されるのは「キーが設定されているか（true/false）」等の状態情報に限る。

### 5. 公開物（site/）への混入防止
- site/ 配下には、APIキーおよびキーに関連する設定・環境情報を出力してはならない。
- site/ にコピーしてよいのは、静的配信に必要な生成物（HTML/JSON/CSS/画像等）に限定する。
- site/ に .env、config、Secrets、実行時設定ダンプ、診断ログなどを含めてはならない。

## 禁止（MUST NOT）
- リポジトリへのAPIキー直書き（コード、テンプレート、設定ファイル、README、Issue、Wiki、コミット履歴）
- 生成物（site/）へのAPIキー混入
- APIキー値のログ出力（print、例外メッセージ、デバッグログ含む）

## 受け入れ基準（Acceptance Criteria）
- 公開リポジトリにおいて、第三者がソース・生成物・ActionsログからAPIキーを復元できない。
- LLM_API_KEY が未設定でも、日次生成が成功し、site/ が更新される（フォールバックで完走）。
- site/ 配下に .env や設定・環境情報が存在しない。
