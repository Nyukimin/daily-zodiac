````md
# 占いWebアプリ（GitHub Pages + GitHub Actions）仕様書 v0.1

最終更新: 2026-02-10（JST）
目的: 「消えずに回る」占い体験を、最小の運用コストで外部公開する。

---

## 1. 目的と前提

### 1.1 目的
- 既存の星座占い資産を核に、Webで配布できる占い体験を作る
- 収益化は広告（PV/クリック）を想定
- 運用で破綻しにくい構造を優先する（サーバ管理をしない）

### 1.2 前提（厳守）
- 占いは娯楽として扱う
- 不安・恐怖・罪悪感で誘導しない（煽り語／断定／緊急性の演出を避ける）
- 外部依存は壊れる前提で設計する
- APIが落ちても「結果は必ず返す」（フォールバックで体験継続）
- 表示は固定フォーマットで統一し、データ差を吸収する
- 同日・同星座は固定（結果が何度も変わらない）
- 計測は最小（PVとクリック程度）。個人追跡はしない

---

## 2. 方式の結論（今回の採用）

### 2.1 採用方式
- ホスティング: GitHub Pages（静的配信）
- 実行: GitHub Actions（Pythonを毎日1回だけ実行）
- 生成物: HTML/JSONを静的ファイルとして生成し、Pagesへデプロイする
- ねらい:
  - サーバ不要（常時稼働なし）
  - アクセス集中でも壊れにくい（静的配信）
  - 日次更新も自動化できる

### 2.2 非採用（今回やらない）
- 常時稼働のPython APIサーバ（FastAPI等）
- DB運用（PostgreSQL等）
- ユーザー単位の履歴・パーソナライズ
- 乱数で毎回変わる占い（「同日・同星座は固定」を優先）
- 複雑なCV計測（PV/クリック以上の追跡）

---

## 3. ユーザー体験（UX）仕様

### 3.1 入口導線（運用方針）
- 主導線: X → Web
- 補助: note → Web（伸びたテーマだけ週1で整理してリンク）
- 例外: X → note → Web（Xで伸びた投稿の解説版を出すときのみ）

### 3.2 ページ構成（最小）
- `/` : 入口ページ（星座一覧 or 悩み選択→星座選択）
- `/{sign}/` : 星座結果ページ（今日の結果）

---

## 4. 出力フォーマット（固定テンプレ）

すべての結果ページは、次の固定フォーマットに揃える。

- 短い要約（1〜3文）
- 選択肢（2〜3個）
- 次の一歩（1つ）

### 4.1 JSON（例）
```json
{
  "date": "YYYY-MM-DD",
  "sign": "aries",
  "summary": "短い要約...",
  "choices": ["選択肢1", "選択肢2", "選択肢3"],
  "next_step": "次の一歩（1つ）"
}
````

### 4.2 HTML（例の構造）

* タイトル（星座名 + 日付）
* summary
* choices（ol/ul）
* next_step

※広告枠（プレースホルダ）を「ページ構造の一部」として固定位置に置く。

---

## 5. データと再現性

### 5.1 同日・同星座の固定

* `date(=JST)` と `sign` の組み合わせで結果が固定されること
* 生成後は当日中に内容が揺れない（キャッシュ/固定データとして扱う）

### 5.2 タイムゾーン

* 日付はJST基準（Asia/Tokyo）で判定する

### 5.3 キャッシュ

* Pagesで配るのは静的ファイルなので、自然にキャッシュが効く
* 生成物は「その日」のスナップショットとして扱う

---

## 6. フォールバック設計（外部依存が落ちても返す）

### 6.1 外部APIを使う場合の位置づけ

* APIは“外部装置”（材料供給）
* API都合で体験が崩れない設計を優先

### 6.2 フォールバック方針

* 日付が変わったタイミングで、12星座分を一括生成して保存する
* APIが失敗した場合でも、フォールバック（事前生成済み or 内製資産）で必ず生成する
* 「API成功時のみ更新」はしない（不安定さを増やすため）

---

## 7. 実装仕様（生成バッチ）

### 7.1 生成対象

* 12星座ぶんの結果
* 出力ファイル:

  * `site/index.html`
  * `site/{sign}/index.html`
  * `site/{sign}/index.json`

### 7.2 リポジトリ構成（最小）

```
/
  generate.py
  requirements.txt        # 必要なら
  site/                   # 生成物（Actionsで生成してアップロード）
  .github/workflows/pages.yml
```

### 7.3 生成スクリプト要件（generate.py）

* JSTで `YYYY-MM-DD` を決める
* 12星座を走査して、固定フォーマットのJSON/HTMLを出力する
* 例外が出ても「全体が落ちない」こと（最低でも既存資産で埋めて出力）

---

## 8. デプロイ仕様（GitHub Actions）

### 8.1 トリガー

* `push`（main）
* `schedule`（毎日1回、UTC cron）
* `workflow_dispatch`（手動）

### 8.2 権限

* `pages: write`
* `id-token: write`
* `contents: read`

### 8.3 デプロイ方式

* `actions/upload-pages-artifact` で `site/` をartifact化
* `actions/deploy-pages` でGitHub Pagesへ反映

---

## 9. 広告仕様（最小）

### 9.1 計測

* PVとクリックのみ想定
* 個人追跡はしない

### 9.2 実装

* まずはプレースホルダ（div）で位置を固定
* 後から広告タグ差し替え可能にする（構造を崩さない）

---

## 10. 運用仕様（回し方）

### 10.1 毎日

* Xに1投稿（結論1行＋リンク）
* Webは日次自動更新（Actions）

### 10.2 毎週

* noteを週1（伸びたテーマの整理）→Webリンク

---

## 11. セキュリティ・プライバシー

* 個人情報を保持しない
* ログはPV/クリック程度
* ユーザー入力が増える場合も、保存しない設計を優先する

---

## 12. 今後の拡張（今回の外側）

* 入力拡張: 生年月日入力（ホロスコープ等）
* 天体計算の導入（SwissEph / Skyfield等）
* テーマ別入口（恋愛/仕事/健康などの「悩み入口」）
* API利用の高度化（ただし主役にしない／落ちても返す）

---

## 13. 決定事項まとめ（今回の合意）

* 公開先: GitHub Pages
* 実行: GitHub Actions（毎日1回の静的生成）
* 出力: 固定フォーマット（要約＋選択肢2〜3＋次の一歩1）
* 方針: 壊れる前提で、必ず結果が返る（フォールバック必須）
* 運用: X→Web を主軸に回す

```

必要なら、この仕様書に合わせて「リポジトリ初期コミット用のファイル一式（generate.py / pages.yml / 最小HTMLテンプレ）」も、コピペ用にまとめて出すよ。
::contentReference[oaicite:0]{index=0}
```
