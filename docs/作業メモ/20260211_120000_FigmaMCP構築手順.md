# Figma MCP 構築手順

**作成日**: 2026-02-11（JST）  
**参照元**: `C:\GenerativeAI\MCP\mcp-server-guide`

**関連ドキュメント**:
- `docs/実装仕様/Figma実装コンテキスト.md` - 実装時のプロジェクトコンテキスト（デザインシステム・変換ルール）
- `docs/作業メモ/FigmaMCP_トラブルシューティング.md` - 接続エラー時の対処
- `rules/common/rules_figma_mcp.md` - 必須フロー・実装ルール

---

## 1. 概要

Figma MCP サーバーを Cursor に組み込み、Figma デザインからコードを生成・実装できるようにする。

### 利用可能なサーバー

| サーバーID | URL | 説明 |
|-----------|-----|------|
| **figma** | https://mcp.figma.com/mcp | リモートサーバー。常時利用可能。Figma アカウント認証が必要。 |
| **figma-desktop** | http://127.0.0.1:3845/mcp | デスクトップアプリ連携。Figma デスクトップで Dev Mode の MCP を有効化する必要あり。 |

---

## 2. 構築済み項目

### 2.1 プロジェクト MCP 設定

**ファイル**: `.cursor/mcp.json`

```json
{
  "mcpServers": {
    "figma": {
      "url": "https://mcp.figma.com/mcp"
    },
    "figma-desktop": {
      "url": "http://127.0.0.1:3845/mcp"
    }
  }
}
```

- プロジェクトルートの `.cursor/mcp.json` に設定済み
- Cursor はプロジェクト設定とグローバル設定をマージする（chrome-devtools, serena はグローバルから継承）

### 2.2 Figma MCP 連携ルール

**ファイル**: `rules/common/rules_figma_mcp.md`

- 必須フロー、URL/ノードID の扱い、プロジェクト固有の実装ルールを定義
- `.cursorrules` に参照を追加済み

### 2.3 Cursor スキル

**追加済みスキル**（`%USERPROFILE%\.cursor\skills-cursor\`）:

- `figma-implement-design` - Figma デザインの実装ワークフロー
- `figma-create-design-rules` - デザインシステムルールの生成

---

## 3. figma-desktop を有効にする場合（オプション）

Figma デスクトップで **選択ベース** のプロンプトを使うには以下が必要：

1. [Figma デスクトップアプリ](https://www.figma.com/downloads/) をインストール
2. 最新版にアップデート
3. デザインファイルを開く
4. ツールバー下部で **Dev Mode** に切り替え（<kbd>Shift</kbd>+<kbd>D</kbd>）
5. インスペクトパネルの「MCP server」セクションで **Enable desktop MCP server** をクリック
6. 確認メッセージが表示されたら有効化完了

---

## 4. 利用方法

### 4.1 リンクベース（figma リモート）

1. Figma でフレームやレイヤーのリンクをコピー
2. Cursor で「この Figma のデザインを実装して」とプロンプト
3. URL の `node-id` が自動で抽出され、MCP ツールでコンテキスト取得

**URL 例**: `https://figma.com/design/xxxxx/FileName?node-id=42-15`

### 4.2 選択ベース（figma-desktop のみ）

1. Figma デスクトップでフレームやレイヤーを選択
2. Cursor で「現在の選択を実装して」とプロンプト
3. 選択ノードが自動で使用される

### 4.3 主なツール

| ツール | 用途 |
|--------|------|
| `get_design_context` | デザインの構造化表現（React+Tailwind形式）を取得 |
| `get_screenshot` | ビジュアルリファレンスのスクリーンショットを取得 |
| `get_metadata` | 大きなデザインのノードマップを取得 |
| `get_variable_defs` | 色・スペーシング・タイポグラフィの変数を取得 |
| `get_code_connect_map` | Figma ノードとコードコンポーネントのマッピングを取得 |
| `create_design_system_rules` | デザインシステムルールを生成 |

---

## 5. 動作確認

1. Cursor を再起動（または MCP サーバーを再接続）
2. チャットで `#get_design_context` と入力し、Figma のツールが利用可能か確認
3. ツールが表示されない場合: **`FigmaMCP_トラブルシューティング.md`** を参照
   - **figma-desktop**: ECONNREFUSED 127.0.0.1:3845 → Figma デスクトップで MCP 有効化
   - **figma リモート**: Needs authentication → Connect で認証
   - **プロジェクト設定が反映されない場合**: 下記「グローバル設定への追加」を実施

### グローバル設定への追加（フォールバック）

プロジェクトの `.cursor/mcp.json` がマージされない場合、グローバル設定に手動で追加する：

1. **Cursor → Settings → Cursor Settings → MCP** を開く
2. **+ Add new global MCP server** をクリック
3. 以下を追加して保存：

```json
"figma": {
  "url": "https://mcp.figma.com/mcp"
},
"figma-desktop": {
  "url": "http://127.0.0.1:3845/mcp"
}
```

または `%USERPROFILE%\.cursor\mcp.json` を直接編集し、既存の `mcpServers` に上記を追加。

---

## 6. レート制限（figma リモート）

- **Starter プラン / View・Collab シート**: 月 6 回まで
- **Dev / Full シート（Professional 以上）**: 分あたりのレート制限（REST API Tier 1 相当）
- 詳細: [Figma MCP 開発者ドキュメント](https://developers.figma.com/docs/figma-mcp-server/)

---

## 7. 本プロジェクトでの実装時の注意

Figma デザインを実装する際は、**`docs/実装仕様/Figma実装コンテキスト.md`** を必ず参照すること。

- 本プロジェクトは **Jinja2 + HTML + Tailwind**（React 非採用）
- Figma MCP のデフォルト出力（React）をそのまま使わず、プロジェクトのデザインシステムに変換する

---

## 8. 参考リンク

- [Figma MCP Server 開発者ドキュメント](https://developers.figma.com/docs/figma-mcp-server/)
- [Code Connect](https://help.figma.com/hc/en-us/articles/23920389749655-Code-Connect)
- mcp-server-guide: `C:\GenerativeAI\MCP\mcp-server-guide\`
