# APIキー設定手順（LLM / Gemini）

## 原則

- APIキーは**リポジトリ内に一切書き込まない**（コード・設定・README・.env をコミットしない）

---

## 1. GitHub Actions（本番運用）

| 項目 | 内容 |
|------|------|
| **どこ** | GitHub リポジトリ設定 |
| **いつ** | 運用開始前に1回 |
| **手順** | リポジトリ → Settings → Secrets and variables → Actions → New repository secret |
| **シークレット名** | `LLM_API_KEY` または `GEMINI_API_KEY` |
| **値** | Google AI Studio で発行した API キー |

workflow（pages.yml）で注入:

```yaml
env:
  LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
```

---

## 2. ローカル開発（.env を使用）

| 項目 | 内容 |
|------|------|
| **どこ** | プロジェクト直下の `.env` ファイル |
| **パス** | `daily-zodiac/.env`（リポジトリルート） |
| **いつ** | `generate.py` を実行するとき（`python-dotenv` で自動読み込み） |

**手順:**

1. プロジェクト直下に `.env` を作成
2. 次の1行を書き込む（`=` の前後にスペース不要）:

```
LLM_API_KEY=あなたのAPIキー
```

3. `.env` は `.gitignore` 済みのためコミットされない
4. `generate.py` 実行時に `python-dotenv` が `.env` を読み込み、環境変数へ注入する

**補足:** `python-dotenv` は `requirements.txt` に含める。LLM 連携実装時に `load_dotenv()` をエントリポイントで呼ぶ。

---

## 3. コードでの取得方法

```python
api_key = os.environ.get("LLM_API_KEY") or os.environ.get("GEMINI_API_KEY")
if not api_key:
    return None  # フォールバックへ
```

- コード内には直書きしない
- 環境変数からのみ取得する

---

## 4. 初回セットアップの流れ

1. [Google AI Studio](https://aistudio.google.com/apikey) で API キーを発行
2. GitHub リポジトリの Settings → Secrets に `LLM_API_KEY` を登録
3. `pages.yml` に `env: LLM_API_KEY: ${{ secrets.LLM_API_KEY }}` を追加（未対応の場合）
4. ローカル確認時: プロジェクト直下の `.env` に `LLM_API_KEY=...` を記載し、`python generate.py` を実行

---

## 5. 参照

- [docs/仕様書/セキュリティーキー仕様.md](../仕様書/セキュリティーキー仕様.md)
